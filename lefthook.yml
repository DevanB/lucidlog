# Lefthook Configuration
# Git hooks management for automated pre-commit code quality checks
# Run on staged files only for fast feedback

pre-commit:
  # Stop on first error for fast feedback
  parallel: false

  commands:
    # 1. Format PHP code with Laravel Pint (auto-fix)
    pint:
      glob: "*.php"
      run: vendor/bin/pint {staged_files}
      stage_fixed: true

    # 2. Lint and format frontend code with Ultracite/Biome (auto-fix)
    ultracite:
      glob: "*.{js,jsx,ts,tsx}"
      run: npx @biomejs/biome check --write {staged_files}
      stage_fixed: true

    # 3. Check TypeScript types
    typescript:
      glob: "*.{ts,tsx}"
      run: npm run types

    # 4. Run Larastan static analysis on staged PHP files
    larastan:
      glob: "*.php"
      run: vendor/bin/phpstan analyse --memory-limit=2G {staged_files} --error-format=table

    # 5. Run Rector PHP upgrade checks on staged PHP files
    rector:
      glob: "*.php"
      run: vendor/bin/rector process {staged_files} --dry-run
# Emergency bypass available with: git commit --no-verify
# Use this only when you need to commit immediately without running checks
